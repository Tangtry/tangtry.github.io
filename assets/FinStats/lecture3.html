<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>è´¢åŠ¡ç®¡ç†ç†è®ºä¸å®åŠ¡</title>
    <meta charset="utf-8" />
    <meta name="author" content="å”æ¶¦å®‡" />
    <meta name="date" content="2023-10-12" />
    <script src="lecture3_files/header-attrs-2.25/header-attrs.js"></script>
    <link href="lecture3_files/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="lecture3_files/remark-css-0.0.1/middlebury.css" rel="stylesheet" />
    <link rel="stylesheet" href="style.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# è´¢åŠ¡ç®¡ç†ç†è®ºä¸å®åŠ¡
]
.subtitle[
## Regression
]
.author[
### å”æ¶¦å®‡
]
.date[
### 2023-10-12
]

---

# å›å½’

Regression is a method for studying the relationship between a response variable (å› å˜é‡) Y and a covariate(è‡ªå˜é‡) X.

ä¸ºä»€ä¹ˆå«å›å½’ï¼Ÿ

é«˜å°”é¡¿ï¼šæœ€è‘—åçš„å‘ç°ä¹‹ä¸€æ˜¯ä»–å‘ç°äº†çˆ¶äº²çš„èº«é«˜å’Œå„¿å­çš„èº«é«˜ä¹‹é—´å­˜åœ¨ç€æŸç§ç»™å®šçš„å…³ç³»ï¼Œä»–é€šè¿‡è¿›ä¸€æ­¥çš„ç ”ç©¶å‘ç°äº†ï¼š

&gt; å­è¾ˆçš„å¹³å‡èº«é«˜æ˜¯å…¶çˆ¶è¾ˆå¹³å‡èº«é«˜ä»¥åŠä»–ä»¬æ‰€å¤„æ—ç¾¤å¹³å‡èº«é«˜çš„åŠ æƒå¹³å‡å’Œã€‚

&gt; å“ªæ€•å•çœ‹ä¸€ç»„çˆ¶äº²å’Œå­©å­çš„èº«é«˜ï¼Œä¸¤ä¸ªäººçš„èº«é«˜å¯èƒ½å·®å¼‚å¾ˆå¤§ï¼Œä½†æ˜¯ä»æ•´ä¸ªäººç¾¤ä¸Šæ¥çœ‹ï¼Œçˆ¶äº²å’Œå­©å­çš„èº«é«˜åˆ†å¸ƒåº”è¯¥æ˜¯å¾ˆç›¸è¿‘çš„ã€‚

å›å½’æ¨¡å‹çš„ä½œç”¨:

- ä¸€ç§å¼ºæœ‰åŠ›çš„åŸºäºæ•°æ®çš„é¢„æµ‹æ¨¡å‹å·¥å…·
- å»ºç«‹ååº”ä¸€ä¸ªå˜é‡çš„å˜åŒ–ä¸å…¶ä»–å˜é‡å˜åŒ–çš„å…¬å¼ã€‚



---
## ç›‘ç£å­¦ä¹ 

åœ¨æœºå™¨å­¦ä¹ çš„åœºæ™¯é‡Œé¢ï¼Œ å›å½’æ˜¯ä¸€ç§ç›‘ç£å­¦ä¹ çš„å·¥å…·ã€‚
ï¼ˆå¯¹æ¯”äºä¸ŠèŠ‚è¯¾çš„èšç±»ï¼šæ— ç›‘ç£å­¦ä¹ ï¼‰

é™¤äº†å›å½’è¿™ç§æ–¹æ³•ï¼Œå…¶ä»–çš„å¸¸è§ç›‘ç£å­¦ä¹ æ–¹æ³•ï¼š

- CART (Classification And Regression Tree) æ ‘æ¨¡å‹
- Kernel Smoothing method
- SVM æ”¯æŒå‘é‡æœº
- Nearest-Neighbors è¿‘é‚»æ³• 
- ...

---
## çº¿æ€§å›å½’

- å› å˜é‡:

æƒ³è¦é¢„æµ‹å’Œåˆ†æçš„å˜é‡ï¼Œé€šå¸¸ç”¨  `\(Y\)`è¡¨ç¤ºã€‚

- è‡ªå˜é‡:

è§£é‡Šå› å˜é‡çš„å˜é‡ï¼Œé€šå¸¸ç”¨ `\(x_1, x_2, â€¦, x_p\)` è¡¨ç¤ºã€‚

- çº¿æ€§å›å½’:
`$$ğ‘Œ=ğ›½_0+ğ›½_1 ğ‘¥_1+ â€¦+ğ›½_p ğ‘¥_p+ğœ–$$`

- ä¸€å…ƒçº¿æ€§å›å½’
$$ Y = \beta_0 + \beta_1 x + \epsilon $$

---
## ä¸€å…ƒçº¿æ€§å›å½’
- æ•°æ®: `\((ğ‘¥_ğ‘–, ğ‘¦_ğ‘– ), \quad ğ‘–=1,â€¦,ğ‘›\)`.

- æˆ‘ä»¬å¸Œæœ›æ‰¾åˆ°ä¸€æ ¹ç›´çº¿ï¼Œâ€œæœ€å¥½â€åœ°æ‹Ÿåˆæ•°æ®

- æ‰¾ç›´çº¿ï¼š â†’ä¼°è®¡ `\(ğ›½_0, \beta_1\)`

- "æœ€å¥½"ï¼š `\(ğ‘¦_ğ‘–\)`ä¸ `\(\hat{y}_i\)` è¶³å¤Ÿæ¥è¿‘ â†’ æœ€å°äºŒä¹˜æ³•ï¼

$$
`\begin{align*}
\min_{\beta_0, \beta_1} Q(\beta_0, \beta_1) &amp;= \min_{\beta_0, \beta_1} \sum_{i=0}^n (y_i - \hat{y}_i)^2\\
&amp;= \min_{\beta_0, \beta_1} \sum_{i=0}^n \left(y_i - (\beta_0 + \beta_1 x_i) \right)^2 
\end{align*}`
$$
---
## æœ€å°äºŒä¹˜æ³• 
.pull-left[
![](Figs/GaussLegendre.png)
]
.pull-right[
é«˜æ–¯ä½¿ç”¨çš„æœ€å°äºŒä¹˜æ³•çš„æ–¹æ³•å‘è¡¨äº1809å¹´ä»–çš„è‘—ä½œã€Šå¤©ä½“è¿åŠ¨è®ºã€‹ä¸­ï¼Œè€Œæ³•å›½ç§‘å­¦å®¶å‹’è®©å¾·äº1806å¹´ç‹¬ç«‹å‘ç°â€œæœ€å°äºŒä¹˜æ³•â€ï¼Œä½†å› ä¸ä¸ºä¸–äººæ‰€çŸ¥è€Œé»˜é»˜æ— é—»ã€‚ä¸¤äººæ›¾ä¸ºè°æœ€æ—©åˆ›ç«‹æœ€å°äºŒä¹˜æ³•åŸç†å‘ç”Ÿäº‰æ‰§ã€‚

]

---
## æœ€å°äºŒä¹˜æ³•

.pull-left[

è¯¯å·®å¹³æ–¹å’Œ `\(Q(\beta_0, \beta_1)\)` æ˜¯å…³äº `\(ğ›½_0, ğ›½_1\)` çš„ä¸€ä¸ªè”åˆå‡¸å‡½æ•°(convex function)

æ±‚å¯¼ä½¿ç”¨FOC (first-order condition)
$$
`\begin{align*}
 &amp; \left\{ \begin{aligned}
  \frac{\partial Q}{\partial \beta_0} = 0 \\
  \frac{\partial Q}{\partial \beta_1} = 0 \\
  \end{aligned} \right. \\
\Rightarrow &amp;    
  \left\{ \begin{aligned}
  &amp;\hat{\beta}_1 = \frac{\sum_{i=1}^n (x_i - \bar{x}) (y_i - \bar{y})}{\sum_{i=1}^n (x_i - \bar{x})^2} \\
 &amp;\hat{\beta}_0 = \bar{y} - \hat{\beta}_1 \bar{x} \\
  \end{aligned} \right.
\end{align*}`
$$

Note. å›å½’çš„ç›´çº¿ä¼šç©¿è¿‡æ ·æœ¬é‡å¿ƒ `\((\bar{x}, \bar{y})\)`.
]
.pull-right[
![](Figs/least_square.gif)
]

---
## æœ€å°äºŒä¹˜æ³•çš„æ€§è´¨

- **çº¿æ€§æ€§**:

`\(\hat{\beta}_0\)` å’Œ `\(\hat{\beta}_1\)` éƒ½æ˜¯ `\(ğ‘¦_ğ‘–\)` çš„çº¿æ€§å‡½æ•°ã€‚

- **æ— åæ€§**:

`$$E[\hat{\beta}_1 ]=\beta_1, \quad E[\hat{\beta}_0 ]=\beta_0.$$`

è¿™é‡Œéœ€è¦å‡è®¾ `\(ğ‘¦_ğ‘–=ğ›½_0+ğ›½_1 ğ‘¥_ğ‘–+ğœ–_ğ‘–\)`  for all `\(i=1,2,â€¦,n\)`, å…¶ä¸­ `\(ğ¸[\epsilon_i]=0\)` for all `\(i=1,2,â€¦,n\)`.

- **å›å½’å‚æ•°ä¼°è®¡å€¼çš„æ–¹å·®**:  
$$ 
`\begin{align*}
&amp;var(\hat{\beta}_1)  =\frac{\sigma^2}{\sum_{i=1}^n (x_i -\bar{x})^2} \\
&amp;var(\hat{\beta}_1)  = \left(\frac{1}{n} + \frac{\bar{x}^2}{\sum_{i=1}^n (x_i -\bar{x})^2} \right) \sigma^2
\end{align*}`
$$
éœ€è¦å‡è®¾ `\(\epsilon_i \sim N(0, \sigma^2 )\)` ç‹¬ç«‹åŒåˆ†å¸ƒ i.i.d

---
## å›å½’æ–¹ç¨‹

ä¸‹é¢çš„è®ºè¿°æ˜¯å¦æ­£ç¡®ï¼Ÿ

- å¯¹äºä»»æ„ä¸¤ç»„æ•°æ®ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥è·‘çº¿æ€§å›å½’ä¼°è®¡å‡ºå¯¹åº”çš„ `\(\hat{\beta}_0\)` å’Œ `\(\hat\beta_1\)`. 

--
![](lecture3_files/figure-html/unnamed-chunk-1-1.png)&lt;!-- --&gt;
![](lecture3_files/figure-html/unnamed-chunk-2-1.png)&lt;!-- --&gt;
æˆ‘ä»¬å¯ä»¥é€šè¿‡ç³»æ•°å¤§å°åˆ¤æ–­çº¿æ€§ç›¸å…³ç¨‹åº¦å—ï¼Ÿ

---
## R square


![](Figs/R2.png)

.center[SST = SSR + SSE]

---
## R square

$$
R^2=1âˆ’ \frac{\sum(y_i - \hat{y}_i)^2}{\sum(y_i - \bar{y})^2} =\frac{\text{SSR}}{\text{SST}}
$$

&amp;nbsp;

`\(R^2\)`æ˜¯ç”±è‡ªå˜é‡ `\(x_1, x_2,...,x_p\)`çš„çº¿æ€§å›å½’ç­‰å¼è§£é‡Šçš„å› å˜é‡ `\(Y\)`çš„è§‚æµ‹å€¼å˜åŒ–å æ€»å˜åŒ–çš„æ¯”ä¾‹ã€‚

- å¦‚æœåœ¨æ€»çš„ç¦»å·®å¹³æ–¹å’Œä¸­å›å½’å¹³æ–¹å’Œæ‰€å çš„æ¯”é‡è¶Šå¤§ï¼Œåˆ™çº¿æ€§å›å½’æ•ˆæœå°±è¶Šå¥½,è¿™è¯´æ˜å›å½’ç›´çº¿ä¸æ ·æœ¬è§‚æµ‹å€¼æ‹Ÿåˆä¼˜åº¦å°±è¶Šå¥½ï¼›å¦‚æœæ®‹å·®å¹³æ–¹å’Œæ‰€å çš„æ¯”é‡å¤§ï¼Œåˆ™å›å½’ç›´çº¿ä¸æ ·æœ¬è§‚æµ‹å€¼æ‹Ÿåˆå¾—ä¸ç†æƒ³ã€‚

- `\(R^2\)`çš„æ•°å€¼æ€»æ˜¯åœ¨0åˆ°1ä¹‹é—´ï¼Œå¦‚æœæ•°å€¼è¶Šé«˜ï¼Œå›å½’æ¨¡å‹çš„æ‹Ÿåˆæ•ˆæœè¶Šå¥½ã€‚

---
## R square

`\(R^2\)` æ€»åœ¨0-1ä¹‹é—´ï¼Œä½†æ˜¯å¯æ¥å—ç¨‹åº¦åœ¨ä¸åŒçš„åœºåˆä¸‹æ˜¯ä¸åŒçš„

&gt; å®è§‚ç»æµæ¨¡å‹ï¼ˆæ¯”å¦‚GNPï¼‰ä¸­, `\(R^2 = 0.35\)`æ˜¯å¯ä»¥æ¥å—çš„;

&gt; åœ¨æˆæœ¬æ¨¡å‹ä¸­ `\(R^2\)`=0.75ä¹Ÿæ˜¯éš¾ä»¥æ¥å—çš„

- ç›¸å…³å…³ç³»â‰ å› æœå…³ç³»ï¼

&gt; å…¬é¸¡æ‰“é¸£-&gt; å¤ªé˜³å‡èµ·ã€ æ‰“é›·-&gt;é—ªç”µ
 
- ç›¸å…³ä½†æ˜¯ä¸æ˜¯åŸå› ï¼

&gt; å†¬å¤©çš„ç¾½ç»’æœé”€é‡é«˜ and å†¬å¤©çš„å¤©ç„¶æ°”ç”¨é‡é«˜


---
## çº¿æ€§å›å½’ in R


```r
library(tidyverse)
setwd("~/XJTU/è¯¾ç¨‹/è´¢åŠ¡ç®¡ç†ç†è®ºä¸å®åŠ¡/Codes")
data &lt;- read_csv("BYD_data.csv")
data |&gt;
  ggplot(mapping = aes(x = RDCost, y = OpeRev)) +
           geom_point()+
           geom_smooth()
```

![](lecture3_files/figure-html/unnamed-chunk-3-1.png)&lt;!-- --&gt;

---
## çº¿æ€§å›å½’ in R


```r
fit &lt;- lm(OpeRev~RDCost, data)
summary(fit)
```

```
## 
## Call:
## lm(formula = OpeRev ~ RDCost, data = data)
## 
## Residuals:
##        Min         1Q     Median         3Q        Max 
## -5.366e+10 -5.273e+09 -1.259e+09  3.992e+09  3.147e+10 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 8.126e+09  2.528e+09   3.214  0.00239 ** 
## RDCost      2.209e+01  5.045e-01  43.793  &lt; 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 1.397e+10 on 46 degrees of freedom
##   (2 observations deleted due to missingness)
## Multiple R-squared:  0.9766,	Adjusted R-squared:  0.9761 
## F-statistic:  1918 on 1 and 46 DF,  p-value: &lt; 2.2e-16
```
---
## å›å½’æ–¹ç¨‹çš„æ˜¾è‘—æ€§æ£€éªŒ

- **å‡è®¾æ£€éªŒ**ï¼šåŸå‡è®¾ `\(H_0: \beta_1 = 0\)`  v.s. å¤‡æ‹©å‡è®¾ `\(H_1: \beta_1 \neq 0\)`.

- å›å½’ç³»æ•°çš„æ˜¾è‘—æ€§æ£€éªŒå°±æ˜¯è¦æ£€éªŒå› å˜é‡ y å¯¹è‡ªå˜é‡ x çš„å½±å“ç¨‹åº¦æ˜¯å¦æ˜¾è‘—ã€‚å¦‚æœä¸æ˜¾è‘—ï¼Œåˆ™å› å˜é‡ y ä¸è‡ªå˜é‡ x ä¹‹é—´å¹¶æ²¡æœ‰çœŸæ­£çš„çº¿æ€§å…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´è‡ªå˜é‡ x çš„å˜åŒ–å¯¹å› å˜é‡ y å¹¶æ²¡æœ‰å½±å“ã€‚

&lt;img src="Figs/hypoTest.jpg" width="569" style="display: block; margin: auto;" /&gt;

---
## å‡è®¾æ£€éªŒ
**å¤§å‰æ**: `\(\epsilon_i \sim N(0, \sigma^2)\)` ä¸”i.i.d. , æ­¤æ—¶ 
`$$\hat{\beta}_1 \sim N \left(\beta_1, \frac{\sigma^2}{\sum_{i=1}^n (x_i - \bar{x})^2}\right).$$`

- t æ£€éªŒ

$$
`\begin{align*}
t=\frac{\hat{\beta}_1 \sqrt{\sum_{i=1}^n (x_i - \bar{x})^2} }{\hat{\sigma}} \sim t(n-2). 
\end{align*}`
$$

- F æ£€éªŒ

`$$F=\frac{\text{SSR}/1}{\text{SSE}/(n-2)} \sim F (1, n-2).$$` 


---
## P value

 â€œç¦»è°±â€çš„æ¦‚ç‡ï¼šå¦‚æœåŸå‡è®¾æˆç«‹ï¼Œå‡ºç°æ¯”å½“å‰çŠ¶å†µæ›´ç¦»è°±çŠ¶å†µçš„æ¦‚ç‡ã€‚

- è¾ƒå°çš„p-valueè¡¨ç¤ºåŸå‡è®¾æ¯”è¾ƒâ€œç¦»è°±â€ï¼Œå› æ­¤æ›´æ”¯æŒå¤‡æ‹©å‡è®¾

é€šå¸¸æˆ‘ä»¬ä½¿ç”¨Î± = 0.05ä½œä¸ºåŸºå‡†.

&gt; p-value &lt; 0.05 is â€œsmallâ€ = â€œstatistically significantâ€.

&gt; p-value &gt; 0.05 is â€œlargeâ€ = â€œnot statistically significantâ€.

- p-value = 0.049 versus p-value = 0.051? 

&gt; Charles Geyer: â€œThe traditional 0.05 dividing line has nothing to recommend it other than that it is a round number. It is a round number because humans have five fingers.â€

- Many advocate abandoning the 0.05 cutoff point.

---
## æ®‹å·®åˆ†æ


```r
plot(fit)
```

![](lecture3_files/figure-html/unnamed-chunk-6-1.png)&lt;!-- --&gt;![](lecture3_files/figure-html/unnamed-chunk-6-2.png)&lt;!-- --&gt;![](lecture3_files/figure-html/unnamed-chunk-6-3.png)&lt;!-- --&gt;![](lecture3_files/figure-html/unnamed-chunk-6-4.png)&lt;!-- --&gt;

???
Residuals versus fitted: æ£€æŸ¥çº¿æ€§æ€§ï¼ˆé›¶å‡å€¼ï¼‰, 

Normal Q-Q: æ£€æµ‹æ­£æ€æ€§.

Scale-Location: æ£€æµ‹å¼‚æ–¹å·®æ€§ï¼ˆå¦‚æœæ®‹å·®éšç€å˜å¤§ï¼Œåˆ™æœ‰å¯èƒ½å¼‚æ–¹å·®.)

Residuals versus leverage:  high residual high leverageçš„å˜é‡å½±å“æ¯”è¾ƒå¤§ï¼Œå¯ä»¥è€ƒè™‘åˆ æ‰ã€‚the 'weighted' distance between x to the mean of x

---
## æ®‹å·®æ£€éªŒ

æ®‹å·®æ£€éªŒå›¾

- Residuals versus fitted: æ£€æŸ¥çº¿æ€§æ€§ï¼ˆé›¶å‡å€¼ï¼‰

- Normal Q-Q: æ£€æµ‹æ­£æ€æ€§.

- Scale-Location: æ£€æµ‹å¼‚æ–¹å·®æ€§ï¼ˆå¦‚æœæ®‹å·®éšç€å˜å¤§ï¼Œåˆ™æœ‰å¯èƒ½å¼‚æ–¹å·®.)

- Residuals versus leverage:  high residual high leverageçš„å˜é‡å½±å“æ¯”è¾ƒå¤§ï¼Œå¯ä»¥è€ƒè™‘åˆ æ‰ã€‚

&gt; leverage is a measure of how far away the independent variable values of an observation are from those of the other observations.

.foot[
Ref: https://www.modernstatisticswithr.com/regression.html#model-diagnostics 
]


---
## æ®‹å·®æ£€éªŒ
æ­£æ€æ£€éªŒï¼š

- Kolmogorovâ€“Smirnov (KS) test:

```r
lillie.test(fit$residuals)
```
- Shapiro-Wilk test:

```r
shapiro.test(fit$residual)
```
- Anderson-Darling test (ad.test) , Cramer-von Mises test (cvm.test)â€¦

 

å¼‚æ–¹å·®æ£€éªŒï¼šthe Breusch-Pagan test

```r
library(car)   # Companion to Applied Regression
ncvTest(fit)   # ncv (non-constant variance) 
```

ç‹¬ç«‹æ€§æ£€éªŒ: Durbin-Watson test

```r
dwt(fit)   # æ£€éªŒè‡ªç›¸å…³æ€§ 
```

---
## ä¾‹å­: CAPM

Capital Asset Pricing Modelï¼Œèµ„æœ¬èµ„äº§å®šä»·æ¨¡å‹
.pull-left[
&lt;img src="Figs/Sharpe.png" width="60%" height="100%" style="display: block; margin: auto;" /&gt;
]
.pull-right[
$$ \text(ER)_i = \text{R}_f + \beta_i (\text{ER}_m - \text{R}_f) $$
å…¶ä¸­ 

- `\(\text{ER}_i\)`: expected return of investment

- `\(\text{R}_f\)`: risk free rate 

- `\(\beta_i\)`: beta of the investment

- `\((\text{ER}_m - \text{R}_f)\)`: market risk premium

]

---
## ä¾‹å­ï¼šCAPM

è´å¡”ç³»æ•°åæ˜ çš„æ˜¯æŸä¸€æŠ•èµ„å¯¹è±¡ç›¸å¯¹äºå¤§ç›˜çš„è¡¨ç°æƒ…å†µã€‚

- å…¶ç»å¯¹å€¼è¶Šå¤§ï¼Œæ˜¾ç¤ºå…¶æ”¶ç›Šå˜åŒ–å¹…åº¦ç›¸å¯¹äºå¤§ç›˜çš„å˜åŒ–å¹…åº¦è¶Šå¤§ï¼›ç»å¯¹å€¼è¶Šå°ï¼Œæ˜¾ç¤ºå…¶å˜åŒ–å¹…åº¦ç›¸å¯¹äºå¤§ç›˜è¶Šå°ã€‚

- å…¨ä½“å¸‚åœºæœ¬èº«çš„Î²ç³»æ•°ä¸º1ï¼Œè‹¥åŸºé‡‘æŠ•èµ„ç»„åˆå‡€å€¼çš„æ³¢åŠ¨å¤§äºå…¨ä½“å¸‚åœºçš„æ³¢åŠ¨å¹…åº¦ï¼Œåˆ™Î²ç³»æ•°å¤§äº1ã€‚åä¹‹ï¼Œè‹¥åŸºé‡‘æŠ•èµ„ç»„åˆå‡€å€¼çš„æ³¢åŠ¨å°äºå…¨ä½“å¸‚åœºçš„æ³¢åŠ¨å¹…åº¦ï¼Œåˆ™Î²ç³»æ•°å°±å°äº1ã€‚Î²ç³»æ•°è¶Šå¤§ä¹‹è¯åˆ¸ï¼Œé€šå¸¸æ˜¯æŠ•æœºæ€§è¾ƒå¼ºçš„è¯åˆ¸ã€‚

**å…¬å¼æ³•**ï¼šé€šè¿‡betaç³»æ•°å…¬å¼ç›´æ¥è®¡ç®—å‡ºbetaç»“æœ `\(\beta_i = (Cov(ğ‘Ÿ_ğ‘–, ğ‘Ÿ_ğ‘š))/(ğœ_ğ‘š^2 )\)`ï¼›

**å›å½’æ³•**ï¼šåŸºäºCAPMæ¨¡å‹çš„æ•°ç†è¡¨è¾¾å¼ï¼Œé€šè¿‡å›å½’åˆ†æä¼°è®¡å‡ºbetaç³»æ•°ï¼›

---
## ä¾‹å­ï¼šCAPM


```r
byd &lt;- read_csv("../Data/002594å†å²æ•°æ® (1).csv")
sz &lt;- read_csv("../Data/æ²ªæ·±300æœŸè´§å†å²æ•°æ® (1).csv")
mt &lt;- read_csv("../Data/600519å†å²æ•°æ® (1).csv")

byd.ratio = as.numeric(sub("%","",byd$æ¶¨è·Œå¹…))
sz.ratio = as.numeric(sub("%","",sz$æ¶¨è·Œå¹…))
beta_1 = cov(byd.ratio,sz.ratio)/var(sz.ratio)
beta_1
```

```
## [1] 1.075929
```

```r
lm1 = lm(byd.ratio~sz.ratio)
lm1$coefficients
```

```
## (Intercept)    sz.ratio 
## -0.01276793  1.07592871
```
Data Source: https://cn.investing.com/equities/byd-a-historical-data


---
## ä¾‹å­ï¼šCAPM


```r
ggplot(mapping = aes(x=byd.ratio, y=sz.ratio)) +
  geom_point() +
  geom_smooth(method="lm")
```

![](lecture3_files/figure-html/unnamed-chunk-13-1.png)&lt;!-- --&gt;

---
## ä¾‹å­ï¼šCAPM


```r
summary(lm1)
```

```
## 
## Call:
## lm(formula = byd.ratio ~ sz.ratio)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.4398 -0.9080 -0.1565  0.7496  6.2587 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -0.01277    0.10536  -0.121    0.904    
## sz.ratio     1.07593    0.10794   9.968   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 1.639 on 240 degrees of freedom
## Multiple R-squared:  0.2928,	Adjusted R-squared:  0.2898 
## F-statistic: 99.35 on 1 and 240 DF,  p-value: &lt; 2.2e-16
```


---
## ä¾‹å­ï¼šCAPM


```r
plot(lm1)
```

![](lecture3_files/figure-html/unnamed-chunk-15-1.png)&lt;!-- --&gt;![](lecture3_files/figure-html/unnamed-chunk-15-2.png)&lt;!-- --&gt;![](lecture3_files/figure-html/unnamed-chunk-15-3.png)&lt;!-- --&gt;![](lecture3_files/figure-html/unnamed-chunk-15-4.png)&lt;!-- --&gt;


---
## ä¾‹å­ï¼šCAPM


```r
mt.ratio = as.numeric(sub("%","",mt$æ¶¨è·Œå¹…))
lm2 = lm(mt.ratio~sz.ratio)
summary(lm2)
```

```
## 
## Call:
## lm(formula = mt.ratio ~ sz.ratio)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.1314 -0.6020  0.1011  0.6976  3.9595 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  0.03069    0.07115   0.431    0.667    
## sz.ratio     1.23138    0.07290  16.892   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 1.107 on 240 degrees of freedom
## Multiple R-squared:  0.5431,	Adjusted R-squared:  0.5412 
## F-statistic: 285.3 on 1 and 240 DF,  p-value: &lt; 2.2e-16
```

---
## ç”»å›¾çš„é‡è¦æ€§


```r
data &lt;- read_csv("../Data/Anscombe.csv")
head(data, n=11)
```

```
## # A tibble: 11 Ã— 6
##        x    y1    y2    y3    x4    y4
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1    10  8.04  9.14  7.46     8  6.58
##  2     8  6.95  8.14  6.77     8  5.76
##  3    13  7.58  8.74 12.7      8  7.71
##  4     9  8.81  8.77  7.11     8  8.84
##  5    11  8.33  9.26  7.81     8  8.47
##  6    14  9.96  8.1   8.84     8  7.04
##  7     6  7.24  6.13  6.08     8  5.25
##  8     4  4.26  3.1   5.39    19 12.5 
##  9    12 10.8   9.13  8.15     8  5.56
## 10     7  4.82  7.26  6.42     8  7.91
## 11     5  5.68  4.74  5.73     8  6.89
```

---
## ç”»å›¾çš„é‡è¦æ€§

```r
lm1 &lt;- lm(y1~x, data)
lm2 &lt;- lm(y2~x, data)
lm3 &lt;- lm(y3~x, data)
lm4 &lt;- lm(y4~x4, data)
```


&amp;nbsp;

å››ä¸ªæ¨¡å‹çš„å›å½’ç»“æœï¼š

| | |
| ------- | -------- |
|è§‚æµ‹å€¼| 11|
|xçš„å‡å€¼| 9|
|yçš„å‡å€¼| 7.5|
|å›å½’æ–¹ç¨‹| y=3+0.5x|
| `\(R^2\)` | 0.667|

---
## ç”»å›¾çš„é‡è¦æ€§

![](lecture3_files/figure-html/unnamed-chunk-19-1.png)&lt;!-- --&gt;![](lecture3_files/figure-html/unnamed-chunk-19-2.png)&lt;!-- --&gt;![](lecture3_files/figure-html/unnamed-chunk-19-3.png)&lt;!-- --&gt;![](lecture3_files/figure-html/unnamed-chunk-19-4.png)&lt;!-- --&gt;

---
## å¤šå…ƒçº¿æ€§å›å½’

`$$Y = \beta_0 + \beta_1 x_2 + ... + \beta_p x_p + \epsilon$$` 

&lt;img src="Figs/multi_least.png" width="1752" /&gt;

---
## æœ€å°äºŒä¹˜æ³•

- æ•°æ®: `\((x_{i1}, x_{i2}, ..., x_{ip}; y_i)\)`, `\(i=1,2,...,n\)`.

- æœ€å°è¯¯å·®å¹³æ–¹å’Œ
$$
`\begin{align*}
\min_{\beta_0, \beta_1, \ldots, \beta_p} \ \sum_{i=1}^n (y_i - \hat{y}_i)^2 = \min_{\beta_0, \beta_1, \ldots, \beta_p} \ \sum_{i=1}^n (y_i - (\beta_0 + \beta_1 x_{i1}+ \beta_2 x_{i2} +...+ \beta_p x_{ip}))^2 
\end{align*}`
$$

æˆ‘ä»¬åŒæ ·å¯ä»¥é€šè¿‡æ±‚å¯¼è”ç«‹FOCå¾—åˆ°æœ€ä¼˜è§£ã€‚

å¦‚æœæˆ‘ä»¬å†™æˆçŸ©é˜µçš„å½¢å¼ `\(\mathbf{\hat{y} = X \hat{\beta} }\)`, æ­¤æ—¶è¯¯å·®å¹³æ–¹å’Œå¯ä»¥å†™æˆ
$$ \min_{\beta} (\mathbf{y-X\beta})^\top (\mathbf{y-X \beta}) .$$
æ­¤æ—¶æœ€å°äºŒä¹˜ä¼°è®¡
$$ \mathbf{\hat{\beta} = (X^\top X)^{-1} X^\top y}.$$
å…¶ä¸­ `\((X^\top X)^{-1} X^\top\)`è¢«ç§°ä¸º `\(X\)`çš„ Pseudo inverse. 

---
## ä¾‹å­ Fama-French Model
.pull-left[
$$\text{ER}_i = \text{R}_f + \beta_i (\text{ER}_m - \text{R}_f) + b_s \text{SMB} + b_v \text{HML} $$

å…¶ä¸­ï¼š

- SMB ï¼š"Small [market capitalization] Minus Big" 

- HML ï¼š "High [book-to-market ratio] Minus Low"; 

&gt; they measure the historic excess returns of small caps over big caps and of value stocks over growth stocks.

]
.pull-right[
![](Figs/Fama_French.png)

Ref: http://mba.tuck.dartmouth.edu/pages/faculty/ken.french/data_library.html

]

---
## ä¾‹å­ Fama-French Model




```r
ff_lreg = lm(AAPL.Rf ~ Mkt.RF + SMB + HML, data = data_ffex)
summary(ff_lreg)
```

```
## 
## Call:
## lm(formula = AAPL.Rf ~ Mkt.RF + SMB + HML, data = data_ffex)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.6545 -0.4038 -0.0205  0.4128  4.2533 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -0.007174   0.063591  -0.113     0.91    
## Mkt.RF       1.230826   0.059702  20.616  &lt; 2e-16 ***
## SMB         -0.447779   0.110587  -4.049 7.10e-05 ***
## HML         -0.426077   0.077755  -5.480 1.15e-07 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.9537 on 222 degrees of freedom
## Multiple R-squared:  0.7316,	Adjusted R-squared:  0.728 
## F-statistic: 201.7 on 3 and 222 DF,  p-value: &lt; 2.2e-16
```

---
## æ®‹å·®åˆ†æ


```r
plot(ff_lreg)
```

![](lecture3_files/figure-html/unnamed-chunk-23-1.png)&lt;!-- --&gt;![](lecture3_files/figure-html/unnamed-chunk-23-2.png)&lt;!-- --&gt;![](lecture3_files/figure-html/unnamed-chunk-23-3.png)&lt;!-- --&gt;![](lecture3_files/figure-html/unnamed-chunk-23-4.png)&lt;!-- --&gt;


---


```r
data_ffex$Rand = rnorm(nrow(data_ffex)) # generate random variables
ff_lreg2 = lm(AAPL.Rf ~ Mkt.RF + SMB + HML + Rand, data = data_ffex)
summary(ff_lreg2)
```

```
## 
## Call:
## lm(formula = AAPL.Rf ~ Mkt.RF + SMB + HML + Rand, data = data_ffex)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.6458 -0.4253 -0.0308  0.4266  4.2254 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -0.005656   0.063854  -0.089    0.929    
## Mkt.RF       1.230289   0.059838  20.560  &lt; 2e-16 ***
## SMB         -0.447561   0.110805  -4.039 7.40e-05 ***
## HML         -0.423674   0.078191  -5.418 1.57e-07 ***
## Rand        -0.024082   0.066640  -0.361    0.718    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.9556 on 221 degrees of freedom
## Multiple R-squared:  0.7318,	Adjusted R-squared:  0.7269 
## F-statistic: 150.7 on 4 and 221 DF,  p-value: &lt; 2.2e-16
```



---
## Adjusted R square

ç”±äºè‡ªå˜é‡ä¸ªæ•°çš„å¢åŠ ï¼Œå°†å½±å“åˆ°å› å˜é‡ä¸­è¢«ä¼°è®¡å›å½’æ–¹ç¨‹ä¸­æ‰€è§£é‡Šçš„å˜å·®æ•°é‡ã€‚å½“å¢åŠ è‡ªå˜é‡æ—¶ï¼Œä¼šä½¿é¢„æµ‹è¯¯å·®å˜å¾—æ¯”è¾ƒå°ï¼Œä»è€Œå‡å°‘æ®‹å·®å¹³æ–¹å’Œ SSEï¼Œç”±äºå›å½’å¹³æ–¹å’Œ SSR=SST-SSEï¼Œå½“ SSE å˜å°æ—¶ï¼ŒSSR ä¼šå˜å¤§ï¼Œä»è€Œ `\(R^2\)` ä¹Ÿä¼šå˜å¤§ã€‚å¦‚æœæ¨¡å‹ä¸­å¢åŠ ä¸€ä¸ªè‡ªå˜é‡ï¼Œå³ä½¿è¿™ä¸ªè‡ªå˜é‡åœ¨ç»Ÿè®¡ä¸Šå¹¶ä¸æ˜¾è‘—ï¼Œ `\(R^2\)` ä¹Ÿä¼šå˜å¤§ï¼Œä¸ºé¿å…è¿™ç§æƒ…å†µï¼Œæå‡º**è°ƒæ•´çš„å¤šé‡åˆ¤å®šç³»æ•°(adjusted multiple coefficient of determination). **

$$ R_a^2 = 1 - \frac{\text{SSE}/(n-p-1)}{\text{SST}/(n-1)} $$

---
## çº¿æ€§å›å½’æ€»ç»“

- æœ€å°äºŒä¹˜æ³•

- `\(R^2\)` ä¸ adjusted `\(R^2\)` 

- å‡è®¾æ£€éªŒï¼š 

&gt; F-test: æ•´ä¸ªæ¨¡å‹çš„æ˜¾è‘—æ€§

&gt; t-test: å•ä¸ªç³»æ•°çš„æ˜¾è‘—æ€§

&gt; p-value

- æ®‹å·®åˆ†æ


---
# æœ‰å®šæ€§å˜é‡çš„å›å½’

- å¦‚æœè‡ªå˜é‡æ˜¯å®šæ€§å˜é‡

&gt; å¼•å…¥è™šæ‹Ÿå˜é‡ dummy variables


```r
lm(y ~ as.factor(x1) + x2)
```

- å¦‚æœå› å˜é‡æ˜¯0-1å˜é‡

&gt; æ–°ä¸šåŠ¡æ˜¯å¦ä¼šæˆåŠŸ

&gt; æ˜¯å¦æ‰¹å‡†è´·æ¬¾

&gt; æ˜å¤©çš„è‚¡ç¥¨æ˜¯æ¶¨è¿˜æ˜¯è·Œ

---
## é€»è¾‘å›å½’ Logistic Regression

![](Figs/logistic_reg.png)

---
## å‚æ•°ä¼°è®¡

$$
`\begin{align*}
  \left\{\begin{aligned}
  P(Y=1) &amp;= \frac{1}{1+ e^{-\beta_0 + \beta_1 x_1+\ldots+ \beta_p x_p}} \\
  P(Y=0) &amp;= \frac{e^{-\beta_0 + \beta_1 x_1+\ldots+ \beta_p x_p}}{1+ e^{-\beta_0 + \beta_1 x_1+\ldots+ \beta_p x_p}}
  \end{aligned}\right.
\end{align*}`
$$

å¯¹äºé€»è¾‘å›å½’ï¼Œæˆ‘ä»¬ä¸ä½¿ç”¨æœ€å°äºŒä¹˜æ³•è¿›è¡Œä¼°è®¡
$$
  \min \sum (Y - P(Y=1))^2
$$

æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨**æå¤§ä¼¼ç„¶ä¼°è®¡**ï¼ˆMaximum Likelihood Estimation, MLE)

$$
`\begin{align*}
\text{Likelihood} = \max \Pi_{i=1}^n \left(\frac{1}{1+z_i}\right)^{Y_i} \left(\frac{z_i}{1+z_i}\right)^{1-Y_i} 
\end{align*}`
$$
$$
`\begin{align*}
\text{Log Likelihood} = \max \sum_{i=1}^n Y_i \log \left(\frac{1}{1+z_i}\right) + (1-Y_i) \log \left(\frac{z_i}{1+z_i}\right)
\end{align*}`
$$


MLEçš„æ€§è´¨ï¼š æ¸è¿›æ— åï¼Œ ç›¸åˆä¸€è‡´

---
## ä¾‹å­ï¼š STé¢„æµ‹

ç›®æ ‡ï¼šä¼°è®¡ä¸Šå¸‚å…¬å¸æ˜¯å¦ä¼šST.

- STè‚¡ç¥¨ï¼Œæ„å³â€œç‰¹åˆ«å¤„ç†(Special treatment)â€çš„è‚¡ç¥¨ã€‚è¯¥æ”¿ç­–é’ˆå¯¹çš„å¯¹è±¡æ˜¯å‡ºç°è´¢åŠ¡çŠ¶å†µæˆ–å…¶ä»–çŠ¶å†µå¼‚å¸¸çš„ã€‚

- å¦‚æœå“ªåªè‚¡ç¥¨çš„åå­—å‰åŠ ä¸ŠSTï¼Œ å°±æ˜¯ç»™å¸‚åœºä¸€ä¸ªè­¦ç¤ºï¼Œè¯¥è‚¡ç¥¨å­˜åœ¨æŠ•èµ„é£é™©ï¼Œä¸€ä¸ªè­¦å‘Šä½œç”¨ï¼Œä½†é€šå¸¸è¿™ç§è‚¡ç¥¨é£é™©å¤§æ”¶ç›Šä¹Ÿå¤§.


**æ”¶é›†çš„æ•°æ®**

| ç®€ç§°  | ST   | ARA    | ASSET  | ATO   | ROA   | GROWTH  | LEV  | SHARE    |
|-----|------|--------|--------|-------|-------|---------|------|----------|
| å˜é‡å | æ˜¯å¦ST | åº”æ”¶è´¦æ¬¾å æ¯” | å¯¹æ•°èµ„äº§è§„æ¨¡ | èµ„äº§å‘¨è½¬ç‡ | èµ„äº§å›æŠ¥ç‡ | é”€å”®æ”¶å…¥å¢é•¿ç‡ | æ æ†æ°´å¹³ | ç¬¬ä¸€è‚¡ä¸œæŒè‚¡æ¯”ç‡ |

---
## ä¾‹å­: STé¢„æµ‹

```r
data &lt;- read_csv("../Data/STé¢„æµ‹.csv")
str(data)
```

```
## spc_tbl_ [684 Ã— 8] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
##  $ ARA   : num [1:684] 0.1923 0.2201 0.3253 0.0257 0.5336 ...
##  $ ASSET : num [1:684] 19.9 20.9 19.4 21.4 21.6 ...
##  $ ATO   : num [1:684] 0.0052 0.0056 0.0166 0.0028 0.2552 ...
##  $ ROA   : num [1:684] 0.08771 0.01682 0.04247 0.01815 0.00415 ...
##  $ GROWTH: num [1:684] -0.951 -0.943 -0.937 -0.853 -0.817 ...
##  $ LEV   : num [1:684] 0.446 0.399 0.303 0.758 0.727 ...
##  $ SHARE : num [1:684] 26.9 39.6 26.5 60.2 54.2 ...
##  $ ST    : num [1:684] 0 0 0 0 1 0 0 0 1 0 ...
##  - attr(*, "spec")=
##   .. cols(
##   ..   ARA = col_double(),
##   ..   ASSET = col_double(),
##   ..   ATO = col_double(),
##   ..   ROA = col_double(),
##   ..   GROWTH = col_double(),
##   ..   LEV = col_double(),
##   ..   SHARE = col_double(),
##   ..   ST = col_double()
##   .. )
##  - attr(*, "problems")=&lt;externalptr&gt;
```



---
## ä¾‹å­: STé¢„æµ‹


![](lecture3_files/figure-html/unnamed-chunk-27-1.png)&lt;!-- --&gt;![](lecture3_files/figure-html/unnamed-chunk-27-2.png)&lt;!-- --&gt;![](lecture3_files/figure-html/unnamed-chunk-27-3.png)&lt;!-- --&gt;![](lecture3_files/figure-html/unnamed-chunk-27-4.png)&lt;!-- --&gt;![](lecture3_files/figure-html/unnamed-chunk-27-5.png)&lt;!-- --&gt;![](lecture3_files/figure-html/unnamed-chunk-27-6.png)&lt;!-- --&gt;

---
## ä¾‹å­: STé¢„æµ‹

![](lecture3_files/figure-html/unnamed-chunk-28-1.png)&lt;!-- --&gt;![](lecture3_files/figure-html/unnamed-chunk-28-2.png)&lt;!-- --&gt;![](lecture3_files/figure-html/unnamed-chunk-28-3.png)&lt;!-- --&gt;![](lecture3_files/figure-html/unnamed-chunk-28-4.png)&lt;!-- --&gt;![](lecture3_files/figure-html/unnamed-chunk-28-5.png)&lt;!-- --&gt;![](lecture3_files/figure-html/unnamed-chunk-28-6.png)&lt;!-- --&gt;

---
## ä¾‹å­: STé¢„æµ‹


```r
model.full=glm(ST~ARA+ASSET+ATO+GROWTH+LEV+ROA+SHARE,family=binomial(link=logit),data=data)
summary(model.full)
```

```
## 
## Call:
## glm(formula = ST ~ ARA + ASSET + ATO + GROWTH + LEV + ROA + SHARE, 
##     family = binomial(link = logit), data = data)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.4165  -0.3354  -0.2536  -0.1958   3.0778  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept) -8.86924    4.63586  -1.913  0.05573 . 
## ARA          4.87974    1.49245   3.270  0.00108 **
## ASSET        0.24660    0.22409   1.100  0.27115   
## ATO         -0.50738    0.65744  -0.772  0.44026   
## GROWTH      -0.83335    0.56706  -1.470  0.14167   
## LEV          2.35415    1.20138   1.960  0.05005 . 
## ROA         -0.63661    6.22354  -0.102  0.91853   
## SHARE       -0.01111    0.01115  -0.997  0.31891   
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 282.07  on 683  degrees of freedom
## Residual deviance: 251.51  on 676  degrees of freedom
## AIC: 267.51
## 
## Number of Fisher Scoring iterations: 6
```

---
## ä¾‹å­: STé¢„æµ‹

æ¨¡å‹é€‰æ‹©ï¼š

- å‘å‰é€‰æ‹©

- å‘åå‰”é™¤

- é€æ­¥å›å½’

é€‰æ‹©çš„æ ‡å‡†:

- AICå‡†åˆ™: Akaike information criterion

&gt; `\(2k -\ln L\)`, è¶Šå°è¶Šå¥½

- BICå‡†åˆ™: Bayesian information criterion

&gt; `\(k \ln n -\ln L\)`, è¶Šå°è¶Šå¥½


---
## ä¾‹å­: STé¢„æµ‹


```r
model.aic=step(model.full, direction='both', trace = F)
summary(model.aic)
```

```
## 
## Call:
## glm(formula = ST ~ ARA + GROWTH + LEV, family = binomial(link = logit), 
##     data = data)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.4020  -0.3323  -0.2647  -0.2119   3.1063  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -4.6022     0.5646  -8.152 3.58e-16 ***
## ARA           5.1301     1.4341   3.577 0.000347 ***
## GROWTH       -0.9061     0.5471  -1.656 0.097708 .  
## LEV           2.5501     1.0778   2.366 0.017986 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 282.07  on 683  degrees of freedom
## Residual deviance: 254.04  on 680  degrees of freedom
## AIC: 262.04
## 
## Number of Fisher Scoring iterations: 6
```

---
## ä¾‹å­: STé¢„æµ‹

### ROC æ›²çº¿

æ¥æ”¶è€…æ“ä½œç‰¹å¾æ›²çº¿ï¼Œæˆ–è€…å«ROCæ›²çº¿ï¼ˆReceiver Operating Characteristic curveï¼‰

- TPRï¼šåœ¨æ‰€æœ‰å®é™…ä¸ºé˜³æ€§çš„æ ·æœ¬ä¸­ï¼Œè¢«æ­£ç¡®åœ°åˆ¤æ–­ä¸ºé˜³æ€§ä¹‹æ¯”ç‡ã€‚

- FPRï¼šåœ¨æ‰€æœ‰å®é™…ä¸ºé˜´æ€§çš„æ ·æœ¬ä¸­ï¼Œè¢«é”™è¯¯åœ°åˆ¤æ–­ä¸ºé˜³æ€§ä¹‹æ¯”ç‡ã€‚

å°†åŒä¸€æ¨¡å‹æ¯ä¸ªé˜ˆå€¼çš„ (FPR, TPR) åæ ‡éƒ½ç”»åœ¨ROCç©ºé—´é‡Œï¼Œå°±æˆä¸ºç‰¹å®šæ¨¡å‹çš„ROCæ›²çº¿ã€‚

---
### ROC æ›²çº¿


```r
#install.packages("pROC")
library(pROC)
predicted.full &lt;- predict(model.full, data, type="response")
roc.full &lt;- roc(data$ST, predicted.full)
ggroc(roc.full)
```

![](lecture3_files/figure-html/unnamed-chunk-31-1.png)&lt;!-- --&gt;

---
### æ¯”è¾ƒä¸¤ä¸ªæ¨¡å‹ ï¼ˆFULL, AIC)


```r
predicted.aic &lt;- predict(model.aic, data, type="response")
roc.aic &lt;- roc(data$ST, predicted.aic)
ggroc(list(AIC=roc.aic, FULL=roc.full))
```

![](lecture3_files/figure-html/unnamed-chunk-32-1.png)&lt;!-- --&gt;





    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
